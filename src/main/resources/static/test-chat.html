<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Testar Chat</title>
    <link rel="stylesheet" href="index.css" />
</head>
<body>
    <h1>Testar Chat</h1>
    <section>
        <h3>Enviar Mensagem</h3>
        <form id="formEnviar">
            <input placeholder="Remetente ID" name="remetenteId" type="number" required />
            <input placeholder="Destinatário ID" name="destinatarioId" type="number" required />
            <input placeholder="Conteúdo" name="conteudo" required />
            <button>Enviar</button>
        </form>
        <pre id="outEnviar"></pre>
    </section>

    <section>
        <h3>Conversa</h3>
        <form id="formConversa">
            <input placeholder="Usuário A ID" name="aId" type="number" required />
            <input placeholder="Usuário B ID" name="bId" type="number" required />
            <button>Buscar</button>
        </form>
        <ul id="lista"></ul>
    </section>

    <script>
        const base = '';
        document.getElementById('formEnviar').addEventListener('submit', async (e) => {
            e.preventDefault();
            const data = Object.fromEntries(new FormData(e.target));
            data.remetenteId = parseInt(data.remetenteId, 10);
            data.destinatarioId = parseInt(data.destinatarioId, 10);
            const res = await fetch(base + '/chat/enviar', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data) });
            document.getElementById('outEnviar').textContent = await res.text();
        });

        document.getElementById('formConversa').addEventListener('submit', async (e) => {
            e.preventDefault();
            const params = new URLSearchParams(Object.fromEntries(new FormData(e.target))).toString();
            const res = await fetch(base + '/chat/conversa?' + params);
            const msgs = await res.json();
            const ul = document.getElementById('lista'); ul.innerHTML = '';
            msgs.forEach(m => {
                const li = document.createElement('li');
                li.textContent = `#${m.id} ${m.criadoEm} - ${m.conteudo}`;
                ul.appendChild(li);
            });
        });
    </script>
</body>
<\/html>


